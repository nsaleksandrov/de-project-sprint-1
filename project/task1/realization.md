# Витрина RFM

## 1.1. Выясните требования к целевой витрине.

Постановка задачи выглядит достаточно абстрактно - постройте витрину. Первым делом вам необходимо выяснить у заказчика детали. Запросите недостающую информацию у заказчика в чате.

Зафиксируйте выясненные требования. Составьте документацию готовящейся витрины на основе заданных вами вопросов, добавив все необходимые детали.

Витрина должна располагаться в той же базе в схеме analysis.
В Витрине нужны данные за 2022, должна состоять из таких полей:
user_id
recency (число от 1 до 5)
frequency (число от 1 до 5)
monetary_value (число от 1 до 5)
Название витрины - dm_rfm_segments. Обновление витрины не требуется.
Успешный заказ - это заказ со статусом closed



## 1.2. Изучите структуру исходных данных.

Полключитесь к базе данных и изучите структуру таблиц.
Если появились вопросы по устройству источника, задайте их в чате.
Зафиксируйте, какие поля вы будете использовать для расчета витрины.

Для расчета витрины нам понадобятся поле user_id(id пользователя) из таблицы orders
Для расчета метрики Recency нам понадобятся также order_ts для вычесления порядка заказов
Для расчета метрики Frequency понадобятся поля user_id и order_id для вычисления количетсва заказов.
Для расчета метрики Monetary Value понадобятся поля payment для оценки потреченной суммы
И поле status из таблицы orders для фильтрации успешных заказов


## 1.3. Проанализируйте качество данных

Изучите качество входных данных. Опишите, насколько качественные данные хранятся в источнике. Так же укажите, какие инструменты обеспечения качества данных были использованы в таблицах в схеме production.

-----------

Данные качественные, типы данных указаны корректно.
Из инструментов это ссылки и ограничения:
CONSTRAINT , CHECK, ADD CONSTAINT , REFERENCES

## 1.4. Подготовьте витрину данных

Теперь, когда требования понятны, а исходные данные изучены, можно приступить к реализации.

### 1.4.1. Сделайте VIEW для таблиц из базы production.**

Вас просят при расчете витрины обращаться только к объектам из схемы analysis. Чтобы не дублировать данные (данные находятся в этой же базе), вы решаете сделать view. Таким образом, View будут находиться в схеме analysis и вычитывать данные из схемы production. 

Напишите SQL-запросы для создания пяти VIEW (по одному на каждую таблицу) и выполните их. Для проверки предоставьте код создания VIEW.

```SQL
create or replace view analysis.products as
select *
from production.products;

create or replace view analysis.orderitems as
select *
from production.orderitems ;

create or replace view analysis.order as
select *
from production.orders ;

create or replace view analysis.orderstatuslog as
select *
from production.orderstatuslog ;

create or replace view analysis.orderstatuses as
select *
from production.orderstatuses ;

create or replace view analysis.users as
select *
from production.users;
```

### 1.4.2. Напишите DDL-запрос для создания витрины.**

Далее вам необходимо создать витрину. Напишите CREATE TABLE запрос и выполните его на предоставленной базе данных в схеме analysis.

```SQL
create table analysis.datamart_ddl(
user_id int8,
recency int8,
frequency int8,
monetary_value int8
)

```

### 1.4.3. Напишите SQL запрос для заполнения витрины

Наконец, реализуйте расчет витрины на языке SQL и заполните таблицу, созданную в предыдущем пункте.

Для решения предоставьте код запроса.

```SQL
--Впишите сюда ваш ответ


```



